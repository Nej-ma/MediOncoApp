{"ast":null,"code":"import _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport AsyncStorage from '@react-native-async-storage/async-storage';\nimport { getAuthToken as fetchAuthToken, fetchGet } from \"../../../services/WebServiceConsumer\";\nvar API_URL = \"http://10.0.2.2:3000\";\nvar AUTH_TOKEN_KEY = 'auth_token';\nvar USER_INFO_KEY = 'user_info';\nexport var authenticate = function () {\n  var _ref = _asyncToGenerator(function* (username, password) {\n    try {\n      var token = yield fetchAuthToken(username, password);\n      if (token) {\n        yield AsyncStorage.setItem(AUTH_TOKEN_KEY, token);\n        return {\n          success: true,\n          token: token\n        };\n      } else {\n        return {\n          success: false,\n          message: 'Authentication failed'\n        };\n      }\n    } catch (error) {\n      console.error('Authentication error:', error);\n      return {\n        success: false,\n        message: error.message || 'Authentication error'\n      };\n    }\n  });\n  return function authenticate(_x, _x2) {\n    return _ref.apply(this, arguments);\n  };\n}();\nexport var changePassword = function () {\n  var _ref2 = _asyncToGenerator(function* (userId, currentPassword, newPassword) {\n    var token = yield AsyncStorage.getItem(AUTH_TOKEN_KEY);\n    console.log('changePassword : ' + userId + ' ' + currentPassword + ' ' + newPassword);\n    try {\n      var response = yield fetch(`${API_URL}/users/${userId}/change-password`, {\n        method: 'PUT',\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${token}`\n        },\n        body: JSON.stringify({\n          currentPassword: currentPassword,\n          newPassword: newPassword\n        })\n      });\n      var data = yield response.text();\n      try {\n        var jsonData = JSON.parse(data);\n        if (response.ok) {\n          return {\n            success: true,\n            data: jsonData\n          };\n        } else {\n          return {\n            success: false,\n            message: jsonData.message || 'Failed to change password'\n          };\n        }\n      } catch (e) {\n        console.error('Error parsing JSON:', e);\n        return {\n          success: false,\n          message: 'Unexpected response from the server'\n        };\n      }\n    } catch (error) {\n      console.error('Error changing password:', error);\n      return {\n        success: false,\n        message: error.message || 'Error changing password'\n      };\n    }\n  });\n  return function changePassword(_x3, _x4, _x5) {\n    return _ref2.apply(this, arguments);\n  };\n}();\nexport var logout = function () {\n  var _ref3 = _asyncToGenerator(function* () {\n    yield AsyncStorage.removeItem(AUTH_TOKEN_KEY);\n    yield AsyncStorage.removeItem(USER_INFO_KEY);\n  });\n  return function logout() {\n    return _ref3.apply(this, arguments);\n  };\n}();\nexport var verifyToken = function () {\n  var _ref4 = _asyncToGenerator(function* () {\n    try {\n      var token = yield AsyncStorage.getItem(AUTH_TOKEN_KEY);\n      if (!token) {\n        return false;\n      }\n      var response = yield fetchGet('users/verify-token', token);\n      if (response.success) {\n        return true;\n      } else {\n        return false;\n      }\n    } catch (error) {\n      console.error('Error verifying token:', error);\n      return false;\n    }\n  });\n  return function verifyToken() {\n    return _ref4.apply(this, arguments);\n  };\n}();\nexport var getUserInfo = function () {\n  var _ref5 = _asyncToGenerator(function* (token) {\n    try {\n      var userInfo = yield fetchGet('users/me', token);\n      yield AsyncStorage.setItem(USER_INFO_KEY, JSON.stringify(userInfo));\n      return userInfo;\n    } catch (error) {\n      console.error('Error fetching user info:', error);\n      throw error;\n    }\n  });\n  return function getUserInfo(_x6) {\n    return _ref5.apply(this, arguments);\n  };\n}();\nexport var getStoredUserInfo = function () {\n  var _ref6 = _asyncToGenerator(function* () {\n    var userInfoString = yield AsyncStorage.getItem(USER_INFO_KEY);\n    return userInfoString ? JSON.parse(userInfoString) : null;\n  });\n  return function getStoredUserInfo() {\n    return _ref6.apply(this, arguments);\n  };\n}();\nexport var getStoredUserInfoString = function () {\n  var _ref7 = _asyncToGenerator(function* () {\n    var userInfoString = yield AsyncStorage.getItem(USER_INFO_KEY);\n    var userInfo = userInfoString ? JSON.parse(userInfoString) : null;\n    return userInfo ? userInfo.username : null;\n  });\n  return function getStoredUserInfoString() {\n    return _ref7.apply(this, arguments);\n  };\n}();","map":{"version":3,"names":["AsyncStorage","getAuthToken","fetchAuthToken","fetchGet","API_URL","AUTH_TOKEN_KEY","USER_INFO_KEY","authenticate","_ref","_asyncToGenerator","username","password","token","setItem","success","message","error","console","_x","_x2","apply","arguments","changePassword","_ref2","userId","currentPassword","newPassword","getItem","log","response","fetch","method","headers","body","JSON","stringify","data","text","jsonData","parse","ok","e","_x3","_x4","_x5","logout","_ref3","removeItem","verifyToken","_ref4","getUserInfo","_ref5","userInfo","_x6","getStoredUserInfo","_ref6","userInfoString","getStoredUserInfoString","_ref7"],"sources":["C:/Users/littl/Desktop/saeapp/frontend/src/features/authentication/services/authService.js"],"sourcesContent":["import AsyncStorage from '@react-native-async-storage/async-storage';\r\nimport { getAuthToken as fetchAuthToken, fetchGet } from '../../../services/WebServiceConsumer';\r\n\r\nconst API_URL = \"http://10.0.2.2:3000\"; // Ensure this matches your backend API URL\r\nconst AUTH_TOKEN_KEY = 'auth_token';\r\nconst USER_INFO_KEY = 'user_info';\r\n\r\nexport const authenticate = async (username, password) => {\r\n    try {\r\n        const token = await fetchAuthToken(username, password);\r\n        if (token) {\r\n            await AsyncStorage.setItem(AUTH_TOKEN_KEY, token);\r\n            return { success: true, token };\r\n        } else {\r\n            return { success: false, message: 'Authentication failed' };\r\n        }\r\n    } catch (error) {\r\n        console.error('Authentication error:', error);\r\n        return { success: false, message: error.message || 'Authentication error' };\r\n    }\r\n};\r\n\r\n// Ensure this function is properly catching and returning errors.\r\nexport const changePassword = async (userId, currentPassword, newPassword) => {\r\n    const token = await AsyncStorage.getItem(AUTH_TOKEN_KEY);\r\n    console.log('changePassword : ' + userId + ' ' + currentPassword + ' ' + newPassword);\r\n    try {\r\n        const response = await fetch(`${API_URL}/users/${userId}/change-password`, {\r\n            method: 'PUT',\r\n            headers: {\r\n                'Content-Type': 'application/json',\r\n                'Authorization': `Bearer ${token}`,\r\n            },\r\n            body: JSON.stringify({ currentPassword, newPassword }),\r\n        });\r\n\r\n        const data = await response.text();\r\n        try {\r\n            const jsonData = JSON.parse(data);\r\n            if (response.ok) {\r\n                return { success: true, data: jsonData };\r\n            } else {\r\n                return { success: false, message: jsonData.message || 'Failed to change password' };\r\n            }\r\n        } catch (e) {\r\n            console.error('Error parsing JSON:', e);\r\n            return { success: false, message: 'Unexpected response from the server' };\r\n        }\r\n    } catch (error) {\r\n        console.error('Error changing password:', error);\r\n        return { success: false, message: error.message || 'Error changing password' };\r\n    }\r\n};\r\n\r\n  \r\nexport const logout = async () => {\r\n    await AsyncStorage.removeItem(AUTH_TOKEN_KEY);\r\n    await AsyncStorage.removeItem(USER_INFO_KEY);\r\n};\r\n\r\nexport const verifyToken = async () => {\r\n    try {\r\n        const token = await AsyncStorage.getItem(AUTH_TOKEN_KEY);\r\n        if (!token) {\r\n            return false;\r\n        }\r\n        const response = await fetchGet('users/verify-token', token);\r\n        if (response.success) {\r\n            return true;\r\n        } else {\r\n            return false;\r\n        }\r\n    } catch (error) {\r\n        console.error('Error verifying token:', error);\r\n        return false;\r\n    }\r\n};\r\n\r\nexport const getUserInfo = async (token) => {\r\n    try {\r\n        const userInfo = await fetchGet('users/me', token);\r\n        await AsyncStorage.setItem(USER_INFO_KEY, JSON.stringify(userInfo));\r\n        return userInfo;\r\n    } catch (error) {\r\n        console.error('Error fetching user info:', error);\r\n        throw error;\r\n    }\r\n};\r\n\r\nexport const getStoredUserInfo = async () => {\r\n    const userInfoString = await AsyncStorage.getItem(USER_INFO_KEY);\r\n    return userInfoString ? JSON.parse(userInfoString) : null;\r\n};\r\n\r\nexport const getStoredUserInfoString = async () => {\r\n    const userInfoString = await AsyncStorage.getItem(USER_INFO_KEY);\r\n    const userInfo = userInfoString ? JSON.parse(userInfoString) : null;\r\n    return userInfo ? userInfo.username : null;\r\n};"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}